{% set p_bulk_indexing_clients = (bulk_indexing_clients | default(20)) %}
{% set p_iterations = bulk_indexing_iterations | default(150000) %}
{% set p_iterations_per_client = (p_iterations / p_bulk_indexing_clients) | int %}

{
  "name": "document_id_evaluation",
  "description": "Index about 30GB of data into five single shard indices using different document ID types. IDs are autogenerated by Elasticsearch, meaning there are no conflicts.",
  "meta": {
    "client_count": {{ p_bulk_indexing_clients }},
    "benchmark_type": "document-id-evaluation"
  },
  "schedule": [
    {
      "name": "deleteindex_elasticlogs-auto",
      "operation": {
        "operation-type": "delete-index",
        "index": "elasticlogs-auto"
      }
    },
    {
      "name": "deleteindex_elasticlogs-uuid",
      "operation": {
        "operation-type": "delete-index",
        "index": "elasticlogs-uuid"
      }
    },
    {
      "name": "deleteindex_elasticlogs-sha1",
      "operation": {
        "operation-type": "delete-index",
        "index": "elasticlogs-sha1"
      }
    },
    {
      "name": "deleteindex_elasticlogs-epoch_uuid",
      "operation": {
        "operation-type": "delete-index",
        "index": "elasticlogs-epoch_uuid"
      }
    },
    {
      "name": "deleteindex_elasticlogs-epoch_md5",
      "operation": {
        "operation-type": "delete-index",
        "index": "elasticlogs-epoch_md5"
      }
    },
    {
      "name": "deleteindex_elasticlogs-epoch_md5-10pct_60s",
      "operation": {
        "operation-type": "delete-index",
        "index": "elasticlogs-epoch_md5-10pct_60s"
      }
    },
    {
      "name": "deleteindex_elasticlogs-epoch_md5-10pct_300s",
      "operation": {
        "operation-type": "delete-index",
        "index": "elasticlogs-epoch_md5-10pct_300s"
      }
    },
    {
      "name": "create_elasticlogs-auto",
      "operation": {
        "operation-type": "createindex",
        "index_name": "elasticlogs-auto",
        "index_template_body": {
          "template": "elasticlogs-auto",
          "settings": {
            "index.refresh_interval": "5s",
            "index.codec": "best_compression",
            "index.number_of_replicas": 0,
            "index.number_of_shards": 1
          },
          "mappings": "mappings.json",
          "aliases": {}
        },
        "index_template_name": "elasticlogs-auto"
      }
    },
    {
      "name": "index-append-1000-elasticlogs-auto",
      "operation": {
        "operation-type": "bulk",
        "param-source": "elasticlogs_bulk",
        "index": "elasticlogs-auto",
        "bulk-size": 1000
      },
      "iterations": {{ p_iterations_per_client }},
      "clients": {{ p_bulk_indexing_clients }},
      "meta": {
        "id_mode": "auto"
      }
    },
    {
      "name": "create_elasticlogs-uuid",
      "operation": {
        "operation-type": "createindex",
        "index_name": "elasticlogs-uuid",
        "index_template_body": {
          "template": "elasticlogs-uuid",
          "settings": {
            "index.refresh_interval": "5s",
            "index.codec": "best_compression",
            "index.number_of_replicas": 0,
            "index.number_of_shards": 1
          },
          "mappings": "mappings.json",
          "aliases": {}
        },
        "index_template_name": "elasticlogs-uuid"
      }
    },
    {
      "name": "index-append-1000-elasticlogs-uuid",
      "operation": {
        "operation-type": "bulk",
        "param-source": "elasticlogs_bulk",
        "index": "elasticlogs-uuid",
        "bulk-size": 1000,
        "id_type": "uuid"
      },
      "iterations": {{ p_iterations_per_client }},
      "clients": {{ p_bulk_indexing_clients }},
      "meta": {
        "id_mode": "uuid"
      }
    },
    {
      "name": "create_elasticlogs-sha1",
      "operation": {
        "operation-type": "createindex",
        "index_name": "elasticlogs-sha1",
        "index_template_body": {
          "template": "elasticlogs-sha1",
          "settings": {
            "index.refresh_interval": "5s",
            "index.codec": "best_compression",
            "index.number_of_replicas": 0,
            "index.number_of_shards": 1
          },
          "mappings": "mappings.json",
          "aliases": {}
        },
        "index_template_name": "elasticlogs-sha1"
      }
    },
    {
      "name": "index-append-1000-elasticlogs-sha1",
      "operation": {
        "operation-type": "bulk",
        "param-source": "elasticlogs_bulk",
        "index": "elasticlogs-sha1",
        "bulk-size": 1000,
        "id_type": "uuid"
      },
      "iterations": {{ p_iterations_per_client }},
      "clients": {{ p_bulk_indexing_clients }},
      "meta": {
        "id_mode": "sha1"
      }
    },
    {
      "name": "create_elasticlogs-epoch_uuid",
      "operation": {
        "operation-type": "createindex",
        "index_name": "elasticlogs-epoch_uuid",
        "index_template_body": {
          "template": "elasticlogs-epoch_uuid",
          "settings": {
            "index.refresh_interval": "5s",
            "index.codec": "best_compression",
            "index.number_of_replicas": 0,
            "index.number_of_shards": 1
          },
          "mappings": "mappings.json",
          "aliases": {}
        },
        "index_template_name": "elasticlogs-epoch_uuid"
      }
    },
    {
      "name": "index-append-1000-elasticlogs-epoch_uuid",
      "operation": {
        "operation-type": "bulk",
        "param-source": "elasticlogs_bulk",
        "index": "elasticlogs-epoch_uuid",
        "bulk-size": 1000,
        "id_type": "epoch_uuid"
      },
      "iterations": {{ p_iterations_per_client }},
      "clients": {{ p_bulk_indexing_clients }},
      "meta": {
        "id_mode": "epoch_uuid"
      }
    },
    {
      "name": "create_elasticlogs-epoch_md5",
      "operation": {
        "operation-type": "createindex",
        "index_name": "elasticlogs-epoch_md5",
        "index_template_body": {
          "template": "elasticlogs-epoch_md5",
          "settings": {
            "index.refresh_interval": "5s",
            "index.codec": "best_compression",
            "index.number_of_replicas": 0,
            "index.number_of_shards": 1
          },
          "mappings": "mappings.json",
          "aliases": {}
        },
        "index_template_name": "elasticlogs-epoch_md5"
      }
    },
    {
      "name": "index-append-1000-elasticlogs-epoch_md5",
      "operation": {
        "operation-type": "bulk",
        "param-source": "elasticlogs_bulk",
        "index": "elasticlogs-epoch_md5",
        "bulk-size": 1000,
        "id_type": "epoch_md5"
      },
      "iterations": {{ p_iterations_per_client }},
      "clients": {{ p_bulk_indexing_clients }},
      "meta": {
        "id_mode": "epoch_md5"
      }
    },
    {
      "name": "create_elasticlogs-epoch_md5-10pct_60s",
      "operation": {
        "operation-type": "createindex",
        "index_name": "elasticlogs-epoch_md5-10pct_60s",
        "index_template_body": {
          "template": "elasticlogs-epoch_md5-10pct_60s",
          "settings": {
            "index.refresh_interval": "5s",
            "index.codec": "best_compression",
            "index.number_of_replicas": 0,
            "index.number_of_shards": 1
          },
          "mappings": "mappings.json",
          "aliases": {}
        },
        "index_template_name": "elasticlogs-epoch_md5-10pct_60s"
      }
    },
    {
      "name": "index-append-1000-elasticlogs-epoch_md5-10pct_60s",
      "operation": {
        "operation-type": "bulk",
        "param-source": "elasticlogs_bulk",
        "index": "elasticlogs-epoch_md5-10pct_60s",
        "bulk-size": 1000,
        "id_type": "epoch_md5",
        "id_delay_probability": 0.1,
        "id_delay_secs": 60
      },
      "iterations": {{ p_iterations_per_client }},
      "clients": {{ p_bulk_indexing_clients }},
      "meta": {
        "id_mode": "epoch_md5-10pct/60s"
      }
    },
    {
      "name": "create_elasticlogs-epoch_md5-10pct_300s",
      "operation": {
        "operation-type": "createindex",
        "index_name": "elasticlogs-epoch_md5-10pct_300s",
        "index_template_body": {
          "template": "elasticlogs-epoch_md5-10pct_300s",
          "settings": {
            "index.refresh_interval": "5s",
            "index.codec": "best_compression",
            "index.number_of_replicas": 0,
            "index.number_of_shards": 1
          },
          "mappings": "mappings.json",
          "aliases": {}
        },
        "index_template_name": "elasticlogs-epoch_md5-10pct_300s"
      }
    },
    {
      "name": "index-append-1000-elasticlogs-epoch_md5-10pct_300s",
      "operation": {
        "operation-type": "bulk",
        "param-source": "elasticlogs_bulk",
        "index": "elasticlogs-epoch_md5-10pct_300s",
        "bulk-size": 1000,
        "id_type": "epoch_md5",
        "id_delay_probability": 0.1,
        "id_delay_secs": 300
      },
      "iterations": {{ p_iterations_per_client }},
      "clients": {{ p_bulk_indexing_clients }},
      "meta": {
        "id_mode": "epoch_md5-10pct/300s"
      }
    },
    {
      "name": "refresh-all",
      "operation": "refresh",
      "iterations": 1,
      "clients": 1
    },
    {% for id_type in ['auto', 'uuid', 'sha1', 'epoch_uuid', 'epoch_md5', 'epoch_md5-10pct_60s', 'epoch_md5-10pct_300s'] %}
    {
      "name": "indicesstats-elasticlogs-{{ id_type }}",
      "operation": {
        "operation-type": "indicesstats",
        "index_pattern": "elasticlogs-{{ id_type }}"
      },
      "meta": {
        "forcemerged": "no",
        "id_mode": "{{ id_type }}"
      }
    },
    {% endfor %}  
    {
      "name": "force-merge-all",
      "operation": {
        "operation-type": "force-merge",
        "max-num-segments": 1
      },
      "clients": 1
    },
    {% for id_type in ['auto', 'uuid', 'sha1', 'epoch_uuid', 'epoch_md5', 'epoch_md5-10pct_60s', 'epoch_md5-10pct_300s'] %}
    {  
      "name": "indicesstats-elasticlogs-fm-{{ id_type }}",
      "operation": {
        "operation-type": "indicesstats",
        "index_pattern": "elasticlogs-{{ id_type }}"
      },
      "meta": {
        "forcemerged": "yes",
        "id_mode": "{{ id_type }}"
      }
    },
    {% endfor %}  
    {
      "name": "refresh-final",
      "operation": "refresh", 
      "iterations": 1,
      "clients": 1
    }
  ]
}
