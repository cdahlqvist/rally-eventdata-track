{% set p_bulk_indexing_clients = (bulk_indexing_clients | default(24)) %}
{% set p_shard_count = (shard_count | default(2)) %}
{% set p_number_of_replicas = (number_of_replicas | default(0)) %}
{% set p_duration = (duration | default(1800)) %}
{% set p_disk_type = disk_type | default('ssd') | lower %}
{% set p_translog_sync = translog_sync | default('request') | lower %}


{
  "name": "refresh-interval",
  "description": "Indexes events into Elasticsearch with varying refresh interval (1, 5 10, 30 and 60 seconds). Each phase by default runs for 30 minutes to ensure segments get reasonably large. IDs are autogenerated by Elasticsearch, meaning there are no conflicts. This process is repeatedly run until 100M events have been indexed into the shard.",
  "meta": {
    "benchmark_type": "refresh-interval"
  },
  "schedule": [
    {
      "name": "deleteindex_elasticlogs-{{ p_disk_type }}-1s",
      "operation": "deleteindex_elasticlogs"
    },
    {
      "name": "create_elasticlogs_index-{{ p_disk_type }}-1s",
      "operation": {
        "operation-type": "createindex",
        "index_name": "elasticlogs",
        "index_template_body": {
          "template": "elasticlogs",
          "settings": {
            "index.refresh_interval": "1s",
            "index.codec": "best_compression",
            {% if (p_translog_sync != 'request') %}
            "index.translog.durability": "async",
            {% endif %}
            {% if (p_disk_type != 'ssd') %}
            "index.merge.scheduler.max_thread_count": 1,
            {% endif %}
            "index.number_of_replicas": {{ p_number_of_replicas }},
            "index.number_of_shards": {{ p_shard_count }}
          },
          "mappings": "mappings.json",
          "aliases": {}
        },
        "index_template_name": "elasticlogs"
      }
    },
    {
      "name": "index-append-1000-shard-sizing-{{ p_disk_type }}-1s",
      "operation": "index-append-1000-shard-sizing",
      "time-period": {{ p_duration }},
      "clients": {{ p_bulk_indexing_clients }},
      "meta": {
        "disk_type": "{{ p_disk_type }}",
        "refresh_interval_secs": 1,
        {% if (p_translog_sync != 'request') %}
        "translog_sync": "{{ p_translog_sync }}",
        {% endif %}
        "shard_count": {{ p_shard_count }},
        "number_of_replicas": {{ p_number_of_replicas }}
      }
    },
    {
      "name": "deleteindex_elasticlogs-{{ p_disk_type }}-5s",
      "operation": "deleteindex_elasticlogs"
    },
    {
      "name": "create_elasticlogs_index-{{ p_disk_type }}-5s",
      "operation": {
        "operation-type": "createindex",
        "index_name": "elasticlogs",
        "index_template_body": {
          "template": "elasticlogs",
          "settings": {
            "index.refresh_interval": "5s",
            "index.codec": "best_compression",
            {% if (p_translog_sync != 'request') %}
            "index.translog.durability": "async",
            {% endif %}
            {% if (p_disk_type != 'ssd') %}
            "index.merge.scheduler.max_thread_count": 1,
            {% endif %}
            "index.number_of_replicas": {{ p_number_of_replicas }},
            "index.number_of_shards": {{ p_shard_count }}
          },
          "mappings": "mappings.json",
          "aliases": {}
        },
        "index_template_name": "elasticlogs"
      }
    },
    {
      "name": "index-append-1000-shard-sizing-{{ p_disk_type }}-5s",
      "operation": "index-append-1000-shard-sizing",
      "time-period": {{ p_duration }},
      "clients": {{ p_bulk_indexing_clients }},
      "meta": {
        "disk_type": "{{ p_disk_type }}",
        "refresh_interval_secs": 5,
        {% if (p_translog_sync != 'request') %}
        "translog_sync": "{{ p_translog_sync }}",
        {% endif %}
        "shard_count": {{ p_shard_count }},
        "number_of_replicas": {{ p_number_of_replicas }}
      }
    },
    {
      "name": "deleteindex_elasticlogs-{{ p_disk_type }}-10s",
      "operation": "deleteindex_elasticlogs"
    },
    {
      "name": "create_elasticlogs_index-{{ p_disk_type }}-10s",
      "operation": {
        "operation-type": "createindex",
        "index_name": "elasticlogs",
        "index_template_body": {
          "template": "elasticlogs",
          "settings": {
            "index.refresh_interval": "10s",
            "index.codec": "best_compression",
            {% if (p_translog_sync != 'request') %}
            "index.translog.durability": "async",
            {% endif %}
            {% if (p_disk_type != 'ssd') %}
            "index.merge.scheduler.max_thread_count": 1,
            {% endif %}
            "index.number_of_replicas": {{ p_number_of_replicas }},
            "index.number_of_shards": {{ p_shard_count }}
          },
          "mappings": "mappings.json",
          "aliases": {}
        },
        "index_template_name": "elasticlogs"
      }
    },
    {
      "name": "index-append-1000-shard-sizing-{{ p_disk_type }}-10s",
      "operation": "index-append-1000-shard-sizing",
      "time-period": {{ p_duration }},
      "clients": {{ p_bulk_indexing_clients }},
      "meta": {
        "disk_type": "{{ p_disk_type }}",
        "refresh_interval_secs": 10,
        {% if (p_translog_sync != 'request') %}
        "translog_sync": "{{ p_translog_sync }}",
        {% endif %}
        "shard_count": {{ p_shard_count }},
        "number_of_replicas": {{ p_number_of_replicas }}
      }
    },
    {
      "name": "deleteindex_elasticlogs-{{ p_disk_type }}-30s",
      "operation": "deleteindex_elasticlogs"
    },
    {
      "name": "create_elasticlogs_index-{{ p_disk_type }}-30s",
      "operation": {
        "operation-type": "createindex",
        "index_name": "elasticlogs",
        "index_template_body": {
          "template": "elasticlogs",
          "settings": {
            "index.refresh_interval": "30s",
            "index.codec": "best_compression",
            {% if (p_translog_sync != 'request') %}
            "index.translog.durability": "async",
            {% endif %}
            {% if (p_disk_type != 'ssd') %}
            "index.merge.scheduler.max_thread_count": 1,
            {% endif %}
            "index.number_of_replicas": {{ p_number_of_replicas }},
            "index.number_of_shards": {{ p_shard_count }}
          },
          "mappings": "mappings.json",
          "aliases": {}
        },
        "index_template_name": "elasticlogs"
      }
    },
    {
      "name": "index-append-1000-shard-sizing-{{ p_disk_type }}-30s",
      "operation": "index-append-1000-shard-sizing",
      "time-period": {{ p_duration }},
      "clients": {{ p_bulk_indexing_clients }},
      "meta": {
        "disk_type": "{{ p_disk_type }}",
        "refresh_interval_secs": 30,
        {% if (p_translog_sync != 'request') %}
        "translog_sync": "{{ p_translog_sync }}",
        {% endif %}
        "shard_count": {{ p_shard_count }},
        "number_of_replicas": {{ p_number_of_replicas }}
      }
    },
    {
      "name": "deleteindex_elasticlogs-{{ p_disk_type }}-60s",
      "operation": "deleteindex_elasticlogs"
    },
    {
      "name": "create_elasticlogs_index-{{ p_disk_type }}-60s",
      "operation": {
        "operation-type": "createindex",
        "index_name": "elasticlogs",
        "index_template_body": {
          "template": "elasticlogs",
          "settings": {
            "index.refresh_interval": "60s",
            "index.codec": "best_compression",
            {% if (p_translog_sync != 'request') %}
            "index.translog.durability": "async",
            {% endif %}
            {% if (p_disk_type != 'ssd') %}
            "index.merge.scheduler.max_thread_count": 1,
            {% endif %}
            "index.number_of_replicas": {{ p_number_of_replicas }},
            "index.number_of_shards": {{ p_shard_count }}
          },
          "mappings": "mappings.json",
          "aliases": {}
        },
        "index_template_name": "elasticlogs"
      }
    },
    {
      "name": "index-append-1000-shard-sizing-{{ p_disk_type }}-60s",
      "operation": "index-append-1000-shard-sizing",
      "time-period": {{ p_duration }},
      "clients": {{ p_bulk_indexing_clients }},
      "meta": {
        "disk_type": "{{ p_disk_type }}",
        "refresh_interval_secs": 60,
        {% if (p_translog_sync != 'request') %}
        "translog_sync": "{{ p_translog_sync }}",
        {% endif %}
        "shard_count": {{ p_shard_count }},
        "number_of_replicas": {{ p_number_of_replicas }}
      }
    },
    {
      "name": "deleteindex_elasticlogs-final",
      "operation": "deleteindex_elasticlogs"
    }
  ]
}
